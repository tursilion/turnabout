Asm994a TMS99000 Assembler - v3.010

                * Asm994a Generated Register Equates
                *
      0000 0000 R0      EQU     0 
      0000 0001 R1      EQU     1 
      0000 0002 R2      EQU     2 
      0000 0003 R3      EQU     3 
      0000 0004 R4      EQU     4 
      0000 0005 R5      EQU     5 
      0000 0006 R6      EQU     6 
      0000 0007 R7      EQU     7 
      0000 0008 R8      EQU     8 
      0000 0009 R9      EQU     9 
      0000 000A R10     EQU     10
      0000 000B R11     EQU     11
      0000 000C R12     EQU     12
      0000 000D R13     EQU     13
      0000 000E R14     EQU     14
      0000 000F R15     EQU     15
                *
   1            * A simple GPU program to set palette 1 at the top of frame, and
   2            * palette 0 for the lower 8 rows.
   3            
   4                AORG >3880
   5            
   6            
   7            MAINLP
   8  3880 04C0     clr r0
   9            
  10  3882 D020     movb @>7000,r0  * get current scanline
  10  3884 7000  
  11  3886 0280     ci r0,>ff00     * bottom of frame (this continues from 255-261 (or 262?)) 
  11  3888 FF00  
  12  388A 1605     jne notbot
  13            
  14  388C 0200     li r0,>0100     * palette 1
  14  388E 0100  
  15  3890 D800     movb r0,@>6018  * VDP register >18 - palette index
  15  3892 6018  
  16  3894 10F5     jmp MAINLP
  17            
  18            notbot
  19  3896 0280     ci r0,>7E00     * scanline 126
  19  3898 7E00  
  20  389A 1604     jne notmid
  21  389C 04C0     clr r0          * palette 0
  22  389E D800     movb r0,@>6018  * VDP register >18 - palette index
  22  38A0 6018  
  23  38A2 10EE     jmp MAINLP
  24            
  25            notmid
  26  38A4 D020     movb @>38ff,r0  * check for command
  26  38A6 38FF  
  27  38A8 13EB     jeq MAINLP      * no command
  28            
  29  38AA 0280     ci r0,>0100     * load palette
  29  38AC 0100  
  30  38AE 160B     jne notload
  31  38B0 0200     li r0,>1000     * palette is located at >1000 after the (valid) pattern table data
  31  38B2 1000  
  32  38B4 0201     li r1,>5020     * F18A palette table, bank 1
  32  38B6 5020  
  33  38B8 0202     li r2,8         * 16 entries to copy, unrolled a bit
  33  38BA 0008  
  34            cplp1
  35  38BC CC70     mov *r0+,*r1+   * move two words
  36  38BE CC70     mov *r0+,*r1+
  37  38C0 0602     dec r2
  38  38C2 16FC     jne cplp1
  39  38C4 1010     jmp clrcmd
  40            
  41            notload
  42  38C6 0280     ci r0,>0200     * invert palette
  42  38C8 0200  
  43  38CA 16DA     jne MAINLP
  44            
  45  38CC 0204     li r4,>FFFF     * something to subtract from (can't remember if 0RGB or RGB0 or what)
  45  38CE FFFF  
  46  38D0 0200     li r0,>1000     * palette is located at >1000 after the (valid) pattern table data
  46  38D2 1000  
  47  38D4 0201     li r1,>5020     * F18A palette table, bank 1
  47  38D6 5020  
  48  38D8 0202     li r2,16        * 16 entries to copy, not as easy to unroll
  48  38DA 0010  
  49            cplp2
  50  38DC C0F0     mov *r0+,r3     * get the entry
  51  38DE 6103     s r3,r4         * subtract it from FFFF
  52  38E0 CC44     mov r4,*r1+     * write the result
  53  38E2 0602     dec r2
  54  38E4 16FB     jne cplp2
  55            
  56            clrcmd
  57  38E6 04E0     clr @>38ff      * zero command byte (and >38fe)
  57  38E8 38FF  
  58  38EA 10CA     jmp MAINLP
  59            
  60  38EC 0000     END
  60            


 Assembly Complete - Errors: 0,  Warnings: 0


 ------ Symbol Listing ------

 CLRCMD ABS:38E6 clrcmd
 CPLP1  ABS:38BC cplp1
 CPLP2  ABS:38DC cplp2
 MAINLP ABS:3880 MAINLP
 NOTBOT ABS:3896 notbot
 NOTLOA ABS:38C6 notload
 NOTMID ABS:38A4 notmid
 R0     ABS:0000 R0
 R1     ABS:0001 R1
 R10    ABS:000A R10
 R11    ABS:000B R11
 R12    ABS:000C R12
 R13    ABS:000D R13
 R14    ABS:000E R14
 R15    ABS:000F R15
 R2     ABS:0002 R2
 R3     ABS:0003 R3
 R4     ABS:0004 R4
 R5     ABS:0005 R5
 R6     ABS:0006 R6
 R7     ABS:0007 R7
 R8     ABS:0008 R8
 R9     ABS:0009 R9
